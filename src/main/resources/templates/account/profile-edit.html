<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/client-layout :: head}"></head>
  <body>
    <!-- Navigation -->
    <nav th:replace="~{fragments/client-layout :: navbar}"></nav>

    <div class="container my-5">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3 mb-4">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <img
                th:src="${nhanSu?.avatarUrl} ?: '/images/default-avatar.svg'"
                alt="Avatar"
                class="rounded-circle mb-3"
                style="width: 80px; height: 80px; object-fit: cover"
              />
              <h5
                class="mb-1"
                th:text="${nhanSu?.hoTen} ?: ${account.username}"
              >
                Tên người dùng
              </h5>
              <p class="text-muted small" th:text="${nhanSu?.email} ?: ${account.email}">
                email@example.com
              </p>
              <span
                class="badge bg-success"
                th:if="${account.status.name() == 'ACTIVE'}"
                >Hoạt động</span
              >
              <span
                class="badge bg-warning"
                th:if="${account.status.name() == 'INACTIVE'}"
                >Không hoạt động</span
              >
            </div>
          </div>

          <!-- Navigation Menu -->
          <div class="card border-0 shadow-sm mt-3">
            <div class="list-group list-group-flush">
              <a
                href="/account/profile"
                class="list-group-item list-group-item-action border-0"
                th:classappend="${activeTab == 'profile'} ? 'active' : ''"
              >
                <i class="fas fa-user me-2"></i>Thông tin cá nhân
              </a>
              <a
                href="/account/my-posts"
                class="list-group-item list-group-item-action border-0"
                th:classappend="${activeTab == 'posts'} ? 'active' : ''"
              >
                <i class="fas fa-edit me-2"></i>Danh sách bài viết
              </a>
              <a
                href="/news"
                class="list-group-item list-group-item-action border-0"
              >
                <i class="fas fa-compass me-2"></i>Khám phá tin tức
              </a>
              <a
                href="/account/posts"
                class="list-group-item list-group-item-action border-0"
                th:classappend="${activeTab == 'create'} ? 'active' : ''"
              >
                <i class="fas fa-plus me-2"></i>Đăng bài viết
              </a>
              <a
                href="/account/security"
                class="list-group-item list-group-item-action border-0"
                th:classappend="${activeTab == 'security'} ? 'active' : ''"
              >
                <i class="fas fa-shield-alt me-2"></i>Bảo mật
              </a>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
              <h4 class="mb-0">
                <i class="fas fa-edit me-2 text-primary"></i>Chỉnh sửa thông tin cá nhân
              </h4>
              <a href="/account/profile" class="btn btn-secondary btn-sm">
                <i class="fas fa-arrow-left me-2"></i>Quay lại
              </a>
            </div>
            <div class="card-body">
              <!-- Alert Messages -->
              <div
                th:if="${success}"
                class="alert alert-success alert-dismissible fade show"
              >
                <i class="fas fa-check-circle me-2"></i>
                <span th:text="${success}"></span>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                ></button>
              </div>

              <div
                th:if="${error}"
                class="alert alert-danger alert-dismissible fade show"
              >
                <i class="fas fa-exclamation-circle me-2"></i>
                <span th:text="${error}"></span>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                ></button>
              </div>

              <!-- Edit Form -->
              <form th:action="@{/account/profile/update}" method="post" th:object="${nhanSu}">
                <input type="hidden" th:field="*{id}">
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="hoTen" class="form-label fw-medium">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="hoTen" th:field="*{hoTen}" 
                           required placeholder="Nhập họ và tên đầy đủ">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="email" class="form-label fw-medium">Email</label>
                    <input type="email" class="form-control" id="email" th:field="*{email}" 
                           placeholder="example@email.com">
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="dienThoai" class="form-label fw-medium">Số điện thoại</label>
                    <input type="tel" class="form-control" id="dienThoai" th:field="*{dienThoai}" 
                           placeholder="0123456789">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="ngaySinh" class="form-label fw-medium">Ngày sinh</label>
                    <input type="date" class="form-control" id="ngaySinh" th:field="*{ngaySinh}">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="diaChi" class="form-label fw-medium">Địa chỉ</label>
                  <textarea class="form-control" id="diaChi" th:field="*{diaChi}" rows="2" 
                            placeholder="Nhập địa chỉ của bạn"></textarea>
                </div>

                <div class="mb-3">
                  <label for="tieuSu" class="form-label fw-medium">Tiểu sử</label>
                  <textarea class="form-control" id="tieuSu" th:field="*{tieuSu}" rows="4" 
                            placeholder="Mô tả về bản thân, quá trình học tập, công tác..."></textarea>
                  <div class="form-text">Tối đa 2000 ký tự</div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                  <a href="/account/profile" class="btn btn-secondary">
                    <i class="fas fa-times me-2"></i>Hủy
                  </a>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Lưu thay đổi
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer th:replace="~{fragments/client-layout :: footer}"></footer>

    <!-- Scripts -->
    <div th:replace="~{fragments/client-layout :: scripts}"></div>

    <script>
      // Phone number validation
      document.getElementById('dienThoai').addEventListener('input', function(e) {
        // Chỉ cho phép nhập số
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Giới hạn độ dài 10-11 số
        if (this.value.length > 11) {
          this.value = this.value.slice(0, 11);
        }
      });

      // Birth date validation
      const birthDateInput = document.getElementById('ngaySinh');
      const today = new Date().toISOString().split('T')[0];
      birthDateInput.setAttribute('max', today);
      
      birthDateInput.addEventListener('change', function(e) {
        const selectedDate = new Date(this.value);
        const currentDate = new Date();
        
        if (selectedDate > currentDate) {
          alert('Ngày sinh không được vượt quá thời gian hiện tại!');
          this.value = '';
        }
      });

      // Tiểu sử character limit
      const tieuSuInput = document.getElementById('tieuSu');
      tieuSuInput.addEventListener('input', function(e) {
        if (this.value.length > 2000) {
          this.value = this.value.substring(0, 2000);
          alert('Tiểu sử không được vượt quá 2000 ký tự!');
        }
      });
    </script>
  </body>
</html>