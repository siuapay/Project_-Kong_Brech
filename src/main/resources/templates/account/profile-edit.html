<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/client-layout :: head}">
    <!-- Account Sidebar Styles -->
    <div th:replace="~{fragments/account-sidebar :: styles}"></div>
    <!-- Toast Notification Styles -->
    <div th:replace="~{fragments/toast-notifications :: styles}"></div>
  </head>
  <body>
    <!-- Navigation -->
    <nav th:replace="~{fragments/client-layout :: navbar}"></nav>

    <div class="container my-5">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3 mb-4">
          <div th:replace="~{fragments/account-sidebar :: sidebar}"></div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
              <h4 class="mb-0">
                <i class="fas fa-edit me-2 text-primary"></i>Chỉnh sửa thông tin cá nhân
              </h4>
              <a href="/account/profile" class="btn btn-secondary btn-sm">
                <i class="fas fa-arrow-left me-2"></i>Quay lại
              </a>
            </div>
            <div class="card-body">
              <!-- Toast Messages (ẩn, sẽ được xử lý bởi JavaScript) -->
              <div th:replace="~{fragments/toast-notifications :: messages}"></div>

              <!-- Edit Form for Nhân Sự -->
              <form th:if="${account.nhanSu != null}" th:action="@{/account/profile/update}" method="post" th:object="${nhanSu}">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" name="profileType" value="nhansu">
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="hoTen" class="form-label fw-medium">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="hoTen" th:field="*{hoTen}" 
                           required placeholder="Nhập họ và tên đầy đủ">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="email" class="form-label fw-medium">Email</label>
                    <input type="email" class="form-control" id="email" th:field="*{email}" 
                           placeholder="example@email.com">
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="dienThoai" class="form-label fw-medium">Số điện thoại</label>
                    <input type="tel" class="form-control" id="dienThoai" th:field="*{dienThoai}" 
                           placeholder="0123456789">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="ngaySinh" class="form-label fw-medium">Ngày sinh</label>
                    <input type="date" class="form-control" id="ngaySinh" th:field="*{ngaySinh}">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="diaChi" class="form-label fw-medium">Địa chỉ</label>
                  <textarea class="form-control" id="diaChi" th:field="*{diaChi}" rows="2" 
                            placeholder="Nhập địa chỉ của bạn"></textarea>
                </div>

                <div class="mb-3">
                  <label for="tieuSu" class="form-label fw-medium">Tiểu sử</label>
                  <textarea class="form-control" id="tieuSu" th:field="*{tieuSu}" rows="4" 
                            placeholder="Mô tả về bản thân, quá trình học tập, công tác..."></textarea>
                  <div class="form-text">Tối đa 2000 ký tự</div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                  <a href="/account/profile" class="btn btn-secondary">
                    <i class="fas fa-times me-2"></i>Hủy
                  </a>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Lưu thay đổi
                  </button>
                </div>
              </form>

              <!-- Edit Form for Chấp Sự -->
              <form th:if="${account.chapSu != null}" th:action="@{/account/profile/update}" method="post" th:object="${chapSu}">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" name="profileType" value="chapsu">
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="hoTenChapSu" class="form-label fw-medium">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="hoTenChapSu" th:field="*{hoTen}" 
                           required placeholder="Nhập họ và tên đầy đủ">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="emailChapSu" class="form-label fw-medium">Email</label>
                    <input type="email" class="form-control" id="emailChapSu" th:field="*{email}" 
                           placeholder="example@email.com">
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="dienThoaiChapSu" class="form-label fw-medium">Số điện thoại</label>
                    <input type="tel" class="form-control" id="dienThoaiChapSu" th:field="*{dienThoai}" 
                           placeholder="0123456789">
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="ngaySinhChapSu" class="form-label fw-medium">Ngày sinh</label>
                    <input type="date" class="form-control" id="ngaySinhChapSu" th:field="*{ngaySinh}">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="diaChiChapSu" class="form-label fw-medium">Địa chỉ</label>
                  <textarea class="form-control" id="diaChiChapSu" th:field="*{diaChi}" rows="2" 
                            placeholder="Nhập địa chỉ của bạn"></textarea>
                </div>

                <div class="mb-3">
                  <label for="tieuSuChapSu" class="form-label fw-medium">Tiểu sử</label>
                  <textarea class="form-control" id="tieuSuChapSu" th:field="*{tieuSu}" rows="4" 
                            placeholder="Mô tả về bản thân, quá trình học tập, công tác..."></textarea>
                  <div class="form-text">Tối đa 2000 ký tự</div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                  <a href="/account/profile" class="btn btn-secondary">
                    <i class="fas fa-times me-2"></i>Hủy
                  </a>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Lưu thay đổi
                  </button>
                </div>
              </form>

              <!-- Message for accounts without profile -->
              <div th:if="${account.nhanSu == null && account.chapSu == null}" class="text-center py-5">
                <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">Chưa có hồ sơ để chỉnh sửa</h5>
                <p class="text-muted">Tài khoản này chưa được liên kết với nhân sự hoặc chấp sự nào.</p>
                <a href="/account/profile" class="btn btn-primary">
                  <i class="fas fa-arrow-left me-2"></i>Quay lại
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer th:replace="~{fragments/client-layout :: footer}"></footer>

    <!-- Scripts -->
    <div th:replace="~{fragments/client-layout :: scripts}"></div>
    <!-- Toast Notification Scripts -->
    <div th:replace="~{fragments/toast-notifications :: scripts}"></div>
    <div th:replace="~{fragments/toast-notifications :: helpers}"></div>

    <script>
      // Phone number validation
      document.getElementById('dienThoai').addEventListener('input', function(e) {
        // Chỉ cho phép nhập số
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Giới hạn độ dài 10-11 số
        if (this.value.length > 11) {
          this.value = this.value.slice(0, 11);
        }
      });

      // Birth date validation
      const birthDateInput = document.getElementById('ngaySinh');
      const today = new Date().toISOString().split('T')[0];
      birthDateInput.setAttribute('max', today);
      
      birthDateInput.addEventListener('change', function(e) {
        const selectedDate = new Date(this.value);
        const currentDate = new Date();
        
        if (selectedDate > currentDate) {
          alert('Ngày sinh không được vượt quá thời gian hiện tại!');
          this.value = '';
        }
      });

      // Tiểu sử character limit
      const tieuSuInput = document.getElementById('tieuSu');
      tieuSuInput.addEventListener('input', function(e) {
        if (this.value.length > 2000) {
          this.value = this.value.substring(0, 2000);
          alert('Tiểu sử không được vượt quá 2000 ký tự!');
        }
      });
    </script>
  </body>
</html>