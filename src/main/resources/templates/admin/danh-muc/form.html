<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/admin-layout :: head}"></th:block>
    <!-- Inline CSS for testing -->
    <style>
        /* Modern Admin Page Styles */
        .modern-admin-page {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
            min-height: 100vh;
        }

        /* Modern Page Header */
        .modern-page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-icon {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0.5rem 0 0 0;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* Modern Buttons */
        .btn-modern {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            cursor: pointer;
        }

        .btn-modern-outline {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-modern-outline:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            text-decoration: none;
        }

        /* Modern Cards */
        .modern-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .card-title h5 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
        }

        .card-title p {
            margin: 0.25rem 0 0 0;
            font-size: 0.875rem;
            color: #718096;
        }

        .card-content {
            padding: 2rem;
        }

        /* Form Sections */
        .form-divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
        }

        .divider-text {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            font-size: 0.95rem;
            text-transform: none;
            letter-spacing: normal;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .divider-text:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .form-section {
            margin-bottom: 2rem;
        }

        /* Modern Form Controls */
        .modern-form-group {
            margin-bottom: 1.5rem;
        }

        .modern-form-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .required-star {
            color: #e53e3e;
            margin-left: 0.25rem;
        }

        .modern-form-control,
        .modern-form-select,
        .modern-form-textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            box-sizing: border-box;
        }

        .modern-form-control:focus,
        .modern-form-select:focus,
        .modern-form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modern-form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-feedback {
            color: #e53e3e;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-hint {
            color: #718096;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Color Input Group */
        .color-input-group {
            display: flex;
            gap: 0.5rem;
        }

        .color-picker {
            width: 60px;
            height: 48px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
            flex-shrink: 0;
        }

        .color-text {
            flex: 1;
            font-family: monospace;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .color-text:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Input Group for Icon */
        .input-group {
            display: flex;
        }

        .input-group-text {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            border-right: none;
            border-radius: 12px 0 0 12px;
            padding: 0.875rem 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
        }

        .input-group .form-control {
            border-left: none;
            border-radius: 0 12px 12px 0;
            flex: 1;
        }

        .input-group .btn {
            border-left: none;
            border-radius: 0 12px 12px 0;
        }

        /* Form Actions */
        .form-actions {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }

        .actions-container {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-cancel {
            padding: 0.875rem 2rem;
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: #edf2f7;
            color: #2d3748;
            text-decoration: none;
        }

        .btn-submit {
            padding: 0.875rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        /* Sidebar Styles */
        .preview-container {
            text-align: center;
            padding: 2rem;
            background: #f7fafc;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .badges {
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quick-action-btn {
            padding: 0.875rem 1rem;
            background: #f7fafc;
            color: #4a5568;
            text-decoration: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }

        .quick-action-btn:hover {
            background: #edf2f7;
            color: #2d3748;
            text-decoration: none;
            transform: translateX(4px);
        }

        /* Icon Picker Modal */
        .icon-option {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .icon-option:hover {
            background-color: #f8f9fa;
            border-color: #007bff !important;
            transform: translateY(-2px);
        }

        .cursor-pointer {
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .actions-container {
                flex-direction: column;
            }

            .input-group {
                flex-direction: column;
            }

            .input-group-text {
                border-radius: 12px 12px 0 0;
                border-right: 2px solid #e2e8f0;
                border-bottom: none;
                width: auto;
            }

            .input-group .form-control {
                border-radius: 0 0 12px 12px;
                border-top: none;
            }

            .input-group .btn {
                border-radius: 0 0 12px 12px;
                border-top: none;
            }

            .color-input-group {
                flex-direction: column;
            }

            .color-preview-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
    </style>
</head>
<body class="modern-admin-page danh-muc-form">
    <!-- Sidebar -->
    <nav th:replace="~{fragments/admin-layout :: sidebar}"></nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Navigation -->
        <nav th:replace="~{fragments/admin-layout :: topnav}"></nav>

        <!-- Content -->
        <div class="container-fluid py-4">
            <!-- Flash Messages -->
            <div th:replace="~{fragments/admin-layout :: messages}"></div>

            <!-- Modern Page Header -->
            <div class="modern-page-header">
                <div class="header-content">
                    <div class="header-info">
                        <div class="header-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="header-text">
                            <h1 class="header-title" th:text="${danhMuc.id != null ? 'Chỉnh Sửa Danh Mục' : 'Thêm Danh Mục Mới'}">Thêm Danh Mục Mới</h1>
                            <p class="header-subtitle">Tạo và quản lý danh mục cho bài viết</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <a th:href="@{/admin/danh-muc}" class="btn-modern btn-modern-outline">
                            <i class="fas fa-arrow-left me-2"></i>Quay Lại
                        </a>
                    </div>
                </div>
            </div>

            <!-- Modern Form -->
            <form th:action="@{/admin/danh-muc/save}" method="post" th:object="${danhMuc}" id="danhMucForm">
                <input type="hidden" th:field="*{id}">
                
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="modern-card">
                            <div class="card-header">
                                <div class="header-left">
                                    <div class="card-icon">
                                        <i class="fas fa-tags"></i>
                                    </div>
                                    <div class="card-title">
                                        <h5>Thông Tin Danh Mục</h5>
                                        <p>Điền đầy đủ thông tin để tạo danh mục</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                
                                <!-- Basic Information Section -->
                                <div class="form-section">
                                    <div class="row g-4">
                                        <div class="col-12">
                                            <div class="modern-form-group">
                                                <label for="tenDanhMuc" class="modern-form-label">
                                                    <i class="fas fa-tag me-2"></i>
                                                    Tên danh mục <span class="required-star">*</span>
                                                </label>
                                                <input type="text" class="modern-form-control" id="tenDanhMuc" th:field="*{tenDanhMuc}" 
                                                       required maxlength="255" onkeyup="generateSlug()" 
                                                       placeholder="Nhập tên danh mục...">
                                                <div class="form-feedback">
                                                    Vui lòng nhập tên danh mục.
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4 mt-2">
                                        <div class="col-12">
                                            <div class="modern-form-group">
                                                <label for="slug" class="modern-form-label">
                                                    <i class="fas fa-link me-2"></i>
                                                    Slug (URL thân thiện)
                                                </label>
                                                <input type="text" class="modern-form-control" id="slug" th:field="*{slug}" 
                                                       maxlength="255" placeholder="url-than-thien">
                                                <div class="form-hint">
                                                    URL: <span class="text-primary" id="slugPreview">/danh-muc/</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4 mt-2">
                                        <div class="col-12">
                                            <div class="modern-form-group">
                                                <label for="moTa" class="modern-form-label">
                                                    <i class="fas fa-align-left me-2"></i>
                                                    Mô tả
                                                </label>
                                                <textarea class="modern-form-textarea" id="moTa" rows="4" th:field="*{moTa}"
                                                          maxlength="1000" placeholder="Mô tả về danh mục này..."></textarea>
                                                <div class="form-hint">Tối đa 1000 ký tự</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4 mt-2">
                                        <div class="col-md-6">
                                            <div class="modern-form-group">
                                                <label for="trangThai" class="modern-form-label">
                                                    <i class="fas fa-toggle-on me-2"></i>
                                                    Trạng thái
                                                </label>
                                                <select class="modern-form-select" id="trangThai" th:field="*{trangThai}">
                                                    <option value="HOAT_DONG">Hoạt động</option>
                                                    <option value="TAM_NGHI">Tạm nghỉ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="modern-form-group">
                                                <label for="mauSac" class="modern-form-label">
                                                    <i class="fas fa-palette me-2"></i>
                                                    Màu sắc
                                                </label>
                                                <div class="color-input-group">
                                                    <input type="color" class="color-picker" id="mauSac" th:field="*{mauSac}" 
                                                           th:value="${danhMuc.mauSac ?: '#007bff'}" title="Chọn màu sắc">
                                                    <input type="text" class="modern-form-control color-text" id="mauSacText" 
                                                           th:value="${danhMuc.mauSac ?: '#007bff'}" placeholder="#007bff" pattern="^#[0-9A-Fa-f]{6}$">
                                                </div>
                                                <div class="form-hint">Chọn màu sắc đại diện cho danh mục</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4 mt-2">
                                        <div class="col-12">
                                            <div class="modern-form-group">
                                                <label for="icon" class="modern-form-label">
                                                    <i class="fas fa-icons me-2"></i>
                                                    Icon danh mục
                                                </label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <i th:class="${danhMuc.icon ?: 'fas fa-tag'}" id="iconPreview" style="font-size: 1.2rem; color: #4a5568;"></i>
                                                    </span>
                                                    <input type="text" class="form-control" th:field="*{icon}" 
                                                           id="iconInput" placeholder="fas fa-tag" readonly>
                                                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#iconPickerModal">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                                <div class="form-hint">
                                                    Click nút tìm kiếm để chọn icon
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Modern Form Actions -->
                                <div class="form-actions">
                                    <div class="actions-container">
                                        <a th:href="@{/admin/danh-muc}" class="btn-cancel">
                                            <i class="fas fa-times me-2"></i>Hủy Bỏ
                                        </a>
                                        <button type="submit" class="btn-submit">
                                            <i class="fas fa-save me-2"></i>
                                            <span th:text="${danhMuc.id != null ? 'Cập Nhật' : 'Lưu Danh Mục'}">Lưu Danh Mục</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modern Sidebar -->
                    <div class="col-lg-4">
                        <!-- Quick Actions -->
                        <div class="modern-card">
                            <div class="card-header">
                                <div class="header-left">
                                    <div class="card-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <div class="card-title">
                                        <h5>Thao Tác Nhanh</h5>
                                        <p>Các hành động liên quan</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="quick-actions">
                                    <a th:href="@{/admin/danh-muc}" class="quick-action-btn">
                                        <i class="fas fa-list me-2"></i>Danh Sách
                                    </a>
                                    <a th:if="${danhMuc.id != null}" 
                                       th:href="@{/admin/danh-muc/view/{id}(id=${danhMuc.id})}" 
                                       class="quick-action-btn">
                                        <i class="fas fa-eye me-2"></i>Xem Chi Tiết
                                    </a>
                                    <a th:href="@{/admin/bai-viet}" class="quick-action-btn">
                                        <i class="fas fa-newspaper me-2"></i>Quản Lý Bài Viết
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- System Information (only show when editing) -->
                        <div th:if="${danhMuc.id != null}" class="modern-card">
                            <div class="card-header">
                                <div class="header-left">
                                    <div class="card-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="card-title">
                                        <h5>Thông Tin Hệ Thống</h5>
                                        <p>Chi tiết về bản ghi</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-value" th:text="${danhMuc.id}">-</div>
                                        <div class="stat-label">ID Danh Mục</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" th:text="${danhMuc.soLuongBaiViet ?: 0}">0</div>
                                        <div class="stat-label">Số Bài Viết</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">
                                            <span th:if="${danhMuc.createdAt}"
                                                  th:text="${#temporals.format(danhMuc.createdAt, 'dd/MM/yyyy')}">-</span>
                                            <span th:unless="${danhMuc.createdAt}">Chưa lưu</span>
                                        </div>
                                        <div class="stat-label">Ngày Tạo</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">
                                            <span th:if="${danhMuc.updatedAt}"
                                                  th:text="${#temporals.format(danhMuc.updatedAt, 'dd/MM/yyyy')}">-</span>
                                            <span th:unless="${danhMuc.updatedAt}">Chưa cập nhật</span>
                                        </div>
                                        <div class="stat-label">Cập Nhật Cuối</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview Card -->
                        <div class="modern-card">
                            <div class="card-header">
                                <div class="header-left">
                                    <div class="card-icon">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="card-title">
                                        <h5>Xem Trước</h5>
                                        <p>Preview danh mục</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="preview-container">
                                    <span class="badges fs-6" id="previewBadge" 
                                          th:style="${danhMuc.mauSac != null} ? 'background-color: ' + ${danhMuc.mauSac} : 'background-color: #007bff'">
                                        <i th:class="${danhMuc.icon ?: 'fas fa-tag'}" class="me-1" id="previewIcon"></i>
                                        <span id="previewText" th:text="${danhMuc.tenDanhMuc ?: 'Tên danh mục'}">Tên danh mục</span>
                                    </span>
                                </div>
                                <div class="form-hint mt-3">Preview sẽ cập nhật tự động khi bạn thay đổi thông tin</div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Icon Picker Modal -->
    <div class="modal fade" id="iconPickerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Chọn Icon Danh Mục</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-2" id="iconGrid">
                        <!-- Icons will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{fragments/admin-layout :: scripts}"></div>
    
    <script>
        // Popular icons for categories
        const categoryIcons = [
            { class: 'fas fa-tag', name: 'Thẻ' },
            { class: 'fas fa-tags', name: 'Nhiều Thẻ' },
            { class: 'fas fa-folder', name: 'Thư Mục' },
            { class: 'fas fa-folder-open', name: 'Thư Mục Mở' },
            { class: 'fas fa-archive', name: 'Lưu Trữ' },
            { class: 'fas fa-newspaper', name: 'Báo' },
            { class: 'fas fa-file-alt', name: 'Tài Liệu' },
            { class: 'fas fa-book', name: 'Sách' },
            { class: 'fas fa-bookmark', name: 'Đánh Dấu' },
            { class: 'fas fa-star', name: 'Ngôi Sao' },
            { class: 'fas fa-heart', name: 'Trái Tim' },
            { class: 'fas fa-thumbs-up', name: 'Thích' },
            { class: 'fas fa-fire', name: 'Hot' },
            { class: 'fas fa-bolt', name: 'Nhanh' },
            { class: 'fas fa-crown', name: 'Vương Miện' },
            { class: 'fas fa-gem', name: 'Ngọc' },
            { class: 'fas fa-award', name: 'Giải Thưởng' },
            { class: 'fas fa-trophy', name: 'Cúp' },
            { class: 'fas fa-medal', name: 'Huy Chương' },
            { class: 'fas fa-ribbon', name: 'Ruy Băng' },
            { class: 'fas fa-flag', name: 'Cờ' },
            { class: 'fas fa-bullhorn', name: 'Thông Báo' },
            { class: 'fas fa-bell', name: 'Chuông' },
            { class: 'fas fa-exclamation', name: 'Chú Ý' },
            { class: 'fas fa-info', name: 'Thông Tin' },
            { class: 'fas fa-question', name: 'Hỏi Đáp' },
            { class: 'fas fa-lightbulb', name: 'Ý Tưởng' },
            { class: 'fas fa-brain', name: 'Trí Tuệ' },
            { class: 'fas fa-graduation-cap', name: 'Giáo Dục' },
            { class: 'fas fa-chalkboard-teacher', name: 'Giảng Dạy' },
            { class: 'fas fa-user-graduate', name: 'Sinh Viên' },
            { class: 'fas fa-school', name: 'Trường Học' },
            { class: 'fas fa-university', name: 'Đại Học' },
            { class: 'fas fa-church', name: 'Nhà Thờ' },
            { class: 'fas fa-cross', name: 'Thánh Giá' },
            { class: 'fas fa-pray', name: 'Cầu Nguyện' },
            { class: 'fas fa-hands-helping', name: 'Giúp Đỡ' },
            { class: 'fas fa-hand-holding-heart', name: 'Trao Yêu Thương' },
            { class: 'fas fa-users', name: 'Cộng Đồng' },
            { class: 'fas fa-user-friends', name: 'Bạn Bè' },
            { class: 'fas fa-people-carry', name: 'Hợp Tác' },
            { class: 'fas fa-handshake', name: 'Bắt Tay' },
            { class: 'fas fa-home', name: 'Nhà' },
            { class: 'fas fa-building', name: 'Tòa Nhà' },
            { class: 'fas fa-city', name: 'Thành Phố' },
            { class: 'fas fa-globe', name: 'Thế Giới' },
            { class: 'fas fa-map-marker-alt', name: 'Vị Trí' },
            { class: 'fas fa-compass', name: 'La Bàn' },
            { class: 'fas fa-route', name: 'Đường Đi' },
            { class: 'fas fa-car', name: 'Xe Hơi' },
            { class: 'fas fa-plane', name: 'Máy Bay' },
            { class: 'fas fa-ship', name: 'Tàu Thủy' },
            { class: 'fas fa-train', name: 'Tàu Hỏa' },
            { class: 'fas fa-bicycle', name: 'Xe Đạp' },
            { class: 'fas fa-motorcycle', name: 'Xe Máy' },
            { class: 'fas fa-bus', name: 'Xe Buýt' },
            { class: 'fas fa-truck', name: 'Xe Tải' }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Populate icon grid
            populateIconGrid();
            
            // Make icon input editable when clicked
            const iconInput = document.getElementById('iconInput');
            if (iconInput) {
                iconInput.addEventListener('click', function() {
                    this.removeAttribute('readonly');
                });
                
                iconInput.addEventListener('blur', function() {
                    this.setAttribute('readonly', 'readonly');
                    updateIconPreview();
                });
                
                iconInput.addEventListener('keyup', function() {
                    updateIconPreview();
                });
            }
            
            // Sync color picker and preview
            const colorPicker = document.getElementById('mauSac');
            const colorPreviewBox = document.getElementById('colorPreviewBox');
            const colorHexDisplay = document.getElementById('colorHexDisplay');
            if (colorPicker && colorPreviewBox && colorHexDisplay) {
                colorPicker.addEventListener('input', function() {
                    const colorValue = this.value;
                    colorPreviewBox.style.backgroundColor = colorValue;
                    colorHexDisplay.textContent = colorValue;
                    updatePreview();
                });
            }
            
            // Initialize preview
            initializePreview();
        });
        
        function populateIconGrid() {
            const iconGrid = document.getElementById('iconGrid');
            iconGrid.innerHTML = '';
            
            categoryIcons.forEach(icon => {
                const iconDiv = document.createElement('div');
                iconDiv.className = 'col-2 mb-2';
                iconDiv.innerHTML = `
                    <div class="icon-option text-center p-2 border rounded cursor-pointer hover-bg-light" 
                         data-icon="${icon.class}" title="${icon.name}"
                         style="cursor: pointer; transition: all 0.2s;">
                        <i class="${icon.class} fa-lg mb-1"></i>
                        <div class="small text-muted">${icon.name}</div>
                    </div>
                `;
                
                // Add hover effect
                const iconOption = iconDiv.querySelector('.icon-option');
                iconOption.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8f9fa';
                    this.style.borderColor = '#007bff';
                });
                
                iconOption.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                    this.style.borderColor = '';
                });
                
                iconOption.addEventListener('click', function() {
                    selectIcon(icon.class);
                });
                
                iconGrid.appendChild(iconDiv);
            });
        }
        
        function selectIcon(iconClass) {
            document.getElementById('iconInput').value = iconClass;
            updateIconPreview();
            updatePreview();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('iconPickerModal'));
            modal.hide();
        }

        // Update icon preview
        function updateIconPreview() {
            const iconClass = document.getElementById('iconInput').value || 'fas fa-tag';
            document.getElementById('iconPreview').className = iconClass;
            document.getElementById('previewIcon').className = iconClass + ' me-1';
        }

        // Generate slug from name
        function generateSlug() {
            const name = document.getElementById('tenDanhMuc').value;
            const slug = name
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[đĐ]/g, 'd')
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
            
            document.getElementById('slug').value = slug;
            document.getElementById('slugPreview').textContent = '/danh-muc/' + slug;
            updatePreview();
        }

        // Update preview
        function updatePreview() {
            const name = document.getElementById('tenDanhMuc').value || 'Tên danh mục';
            const color = document.getElementById('mauSac').value || '#007bff';
            
            document.getElementById('previewText').textContent = name;
            document.getElementById('previewBadge').style.backgroundColor = color;
        }

        // Sync color inputs
        function syncColorInputs() {
            const mauSacInput = document.getElementById('mauSac');
            const mauSacTextInput = document.getElementById('mauSacText');
            
            if (mauSacInput && mauSacTextInput) {
                // Sync color picker to text input
                mauSacInput.addEventListener('input', function() {
                    mauSacTextInput.value = this.value;
                    updatePreview();
                });
                
                // Sync text input to color picker
                mauSacTextInput.addEventListener('input', function() {
                    if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                        mauSacInput.value = this.value;
                        updatePreview();
                    }
                });
            }
        }

        // Initialize preview
        function initializePreview() {
            const tenDanhMucInput = document.getElementById('tenDanhMuc');
            const mauSacInput = document.getElementById('mauSac');
            
            if (tenDanhMucInput) {
                tenDanhMucInput.addEventListener('input', updatePreview);
            }
            
            if (mauSacInput) {
                mauSacInput.addEventListener('change', updatePreview);
            }
            
            // Initialize color sync
            syncColorInputs();
            
            // Initialize all previews
            updateIconPreview();
            updatePreview();
        }
    </script>

  
    </style>
</body>
</html>