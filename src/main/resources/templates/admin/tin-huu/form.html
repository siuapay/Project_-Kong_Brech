<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/admin-layout :: head}">
  <link href="/static/css/searchable-dropdown.css" rel="stylesheet">
</head>

<body class="modern-admin-page">
  <!-- Sidebar -->
  <nav th:replace="~{fragments/admin-layout :: sidebar}"></nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Navigation -->
    <nav th:replace="~{fragments/admin-layout :: topnav}"></nav>

    <!-- Content -->
    <div class="container-fluid py-4">
      <!-- Flash Messages -->
      <div th:replace="~{fragments/admin-layout :: messages}"></div>

      <!-- Modern Page Header -->
      <div class="modern-page-header">
        <div class="header-content">
          <div class="header-info">
            <div class="header-icon">
              <i class="fas fa-user-plus"></i>
            </div>
            <div class="header-text">
              <h1 class="header-title" th:text="${tinHuu.id != null ? 'Chỉnh Sửa Tin Hữu' : 'Thêm Tin Hữu Mới'}">Thêm Tin Hữu Mới</h1>
              <p class="header-subtitle">Nhập thông tin chi tiết của tin hữu để quản lý hiệu quả</p>
            </div>
          </div>
          <div class="header-actions">
            <a th:href="@{/admin/tin-huu}" class="btn-modern btn-modern-outline">
              <i class="fas fa-arrow-left me-2"></i>Quay Lại
            </a>
          </div>
        </div>
      </div>

      <!-- Modern Form -->
      <div class="row g-4">
        <div class="col-lg-8">
          <div class="modern-card">
            <div class="card-header">
              <div class="header-left">
                <div class="card-icon">
                  <i class="fas fa-user-edit"></i>
                </div>
                <div class="card-title">
                  <h5>Thông Tin Cá Nhân</h5>
                  <p>Điền đầy đủ thông tin để tạo hồ sơ tin hữu</p>
                </div>
              </div>
            </div>
            <div class="card-content">
              <form th:action="@{/admin/tin-huu/save}" th:object="${tinHuu}" method="post"
                enctype="multipart/form-data">
                <input type="hidden" th:field="*{id}" />
                <input type="hidden" th:field="*{createdAt}" />
                <input type="hidden" th:field="*{avatarUrl}" />

                <!-- Modern Avatar Upload Section -->
                <div class="avatar-upload-section">
                  <div class="section-header">
                    <div class="section-icon">
                      <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="section-title">
                      <h4>Ảnh Đại Diện</h4>
                      <p>Tải lên ảnh đại diện cho tin hữu</p>
                    </div>
                  </div>
                  
                  <div class="avatar-upload-container">
                    <!-- Avatar Preview -->
                    <div class="avatar-preview-wrapper">
                      <div class="avatar-preview-circle">
                        <img id="avatarPreview"
                          th:src="${tinHuu.avatarUrl != null ? tinHuu.avatarUrl : '/static/images/default-avatar.svg'}"
                          alt="Avatar Preview" />
                        <div class="avatar-overlay">
                          <i class="fas fa-camera"></i>
                        </div>
                      </div>
                    </div>

                    <!-- Upload Controls -->
                    <div class="avatar-upload-controls">
                      <div class="upload-input-wrapper">
                        <label for="avatarFile" class="upload-btn">
                          <i class="fas fa-cloud-upload-alt me-2"></i>
                          Chọn Ảnh Mới
                        </label>
                        <input type="file" class="d-none" id="avatarFile" name="avatarFile"
                          accept="image/jpeg,image/jpg,image/png,image/gif" onchange="previewAvatar(this)" />
                      </div>
                      
                      <div class="upload-info">
                        <div class="info-item">
                          <i class="fas fa-check-circle text-success me-2"></i>
                          <span>JPG, JPEG, PNG, GIF</span>
                        </div>
                        <div class="info-item">
                          <i class="fas fa-weight-hanging text-info me-2"></i>
                          <span>Tối đa 5MB</span>
                        </div>
                      </div>

                      <!-- Upload Status -->
                      <div id="uploadStatus" class="upload-status d-none">
                        <div class="status-message">
                          <i class="fas fa-check-circle me-2"></i>
                          Ảnh mới đã được chọn. Nhấn "Lưu" để cập nhật.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Form Divider -->
                <div class="form-divider">
                  <div class="divider-line"></div>
                  <div class="divider-text">Thông tin cơ bản</div>
                  <div class="divider-line"></div>
                </div>

                <!-- Basic Information -->
                <div class="form-section">
                  <div class="row g-4">
                    <div class="col-md-8">
                      <div class="modern-form-group">
                        <label for="hoTen" class="modern-form-label">
                          <i class="fas fa-user me-2"></i>
                          Họ và Tên <span class="required-star">*</span>
                        </label>
                        <input type="text" class="modern-form-control" id="hoTen" th:field="*{hoTen}" required
                          placeholder="Nhập họ và tên đầy đủ" />
                        <div class="form-feedback">
                          Vui lòng nhập họ và tên.
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="modern-form-group">
                        <label for="gioiTinh" class="modern-form-label">
                          <i class="fas fa-venus-mars me-2"></i>
                          Giới Tính
                        </label>
                        <select class="modern-form-select" id="gioiTinh" th:field="*{gioiTinh}" required>
                          <option value="Nam">Nam</option>
                          <option value="Nữ">Nữ</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="row g-4 mt-2">
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="namSinh" class="modern-form-label">
                          <i class="fas fa-birthday-cake me-2"></i>
                          Năm Sinh
                        </label>
                        <input type="number" class="modern-form-control" id="namSinh" th:field="*{namSinh}" min="1900"
                          placeholder="Ví dụ: 1990" />
                        <div class="form-hint">Năm sinh không được vượt quá năm hiện tại</div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="ngheNghiep" class="modern-form-label">
                          <i class="fas fa-briefcase me-2"></i>
                          Nghề Nghiệp
                        </label>
                        <input type="text" class="modern-form-control" id="ngheNghiep" th:field="*{ngheNghiep}"
                          placeholder="Ví dụ: Giáo viên, Kỹ sư..." />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Contact Information -->
                <div class="form-divider">
                  <div class="divider-line"></div>
                  <div class="divider-text">
                    <i class="fas fa-address-book me-2"></i>Thông tin liên hệ
                  </div>
                  <div class="divider-line"></div>
                </div>

                <div class="form-section">
                  <div class="row g-4">
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="dienThoai" class="modern-form-label">
                          <i class="fas fa-phone me-2"></i>
                          Số Điện Thoại
                        </label>
                        <input type="tel" class="modern-form-control" id="dienThoai" th:field="*{dienThoai}" 
                          pattern="[0-9]{10,11}" title="Số điện thoại phải có 10-11 chữ số" placeholder="0123456789" />
                        <div class="form-hint">Chỉ nhập số, từ 10-11 chữ số</div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="email" class="modern-form-label">
                          <i class="fas fa-envelope me-2"></i>
                          Email
                        </label>
                        <input type="email" class="modern-form-control" id="email" th:field="*{email}"
                          placeholder="example@email.com" />
                      </div>
                    </div>
                  </div>

                  <div class="row g-4 mt-2">
                    <div class="col-12">
                      <div class="modern-form-group">
                        <label for="diaChi" class="modern-form-label">
                          <i class="fas fa-map-marker-alt me-2"></i>
                          Địa Chỉ
                        </label>
                        <textarea class="modern-form-textarea" id="diaChi" rows="3" th:field="*{diaChi}"
                          placeholder="Nhập địa chỉ đầy đủ"></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Church Information -->
                <div class="form-divider">
                  <div class="divider-line"></div>
                  <div class="divider-text">
                    <i class="fas fa-church me-2"></i>Thông tin tôn giáo
                  </div>
                  <div class="divider-line"></div>
                </div>

                <div class="form-section">
                  <div class="row g-4">
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="banNganh" class="modern-form-label">
                          <i class="fas fa-sitemap me-2"></i>
                          Ban Ngành
                        </label>
                        <div id="banNganhDropdown"></div>
                        <input type="hidden" id="banNganh" th:field="*{banNganh.id}">
                        <div class="form-hint">Chọn ban ngành mà tin hữu tham gia</div>
                      </div>
                    </div>
                    <!-- COMMENTED OUT - Nhóm functionality for future use -->
                    <!--
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="nhom" class="modern-form-label">
                          <i class="fas fa-users me-2"></i>
                          Nhóm
                        </label>
                        <div id="nhomDropdown"></div>
                        <input type="hidden" id="nhom" th:field="*{nhom.id}">
                        <div class="form-hint">Chọn nhóm mà tin hữu tham gia (hiển thị điểm nhóm)</div>
                      </div>
                    </div>
                    -->
                  </div>

                  <div class="row g-4 mt-2">
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="ngayBaoTin" class="modern-form-label">
                          <i class="fas fa-calendar-check me-2"></i>
                          Ngày Báo Tin
                        </label>
                        <input type="date" class="modern-form-control" id="ngayBaoTin" name="ngayBaoTin"
                          th:value="${tinHuu.ngayBaoTin != null ? tinHuu.ngayBaoTin : ''}" />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="modern-form-group">
                        <label for="trangThai" class="modern-form-label">
                          <i class="fas fa-toggle-on me-2"></i>
                          Trạng Thái
                        </label>
                        <select class="modern-form-select" id="trangThai" th:field="*{trangThai}">
                          <option value="HOAT_DONG">Hoạt động</option>
                          <option value="TAM_NGHI">Tạm nghỉ</option>
                          <option value="CHUYEN_DI">Chuyển đi</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="row g-4 mt-2">
                    <div class="col-12">
                      <div class="modern-form-group">
                        <label for="ghiChu" class="modern-form-label">
                          <i class="fas fa-sticky-note me-2"></i>
                          Ghi Chú
                        </label>
                        <textarea class="modern-form-textarea" id="ghiChu" rows="4" th:field="*{ghiChu}"
                          placeholder="Ghi chú thêm về tin hữu..."></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Modern Form Actions -->
                <div class="form-actions">
                  <div class="actions-container">
                    <a th:href="@{/admin/tin-huu}" class="btn-cancel">
                      <i class="fas fa-times me-2"></i>Hủy Bỏ
                    </a>
                    <button type="submit" class="btn-submit">
                      <i class="fas fa-save me-2"></i>
                      <span th:text="${tinHuu.id != null ? 'Cập Nhật' : 'Lưu Tin Hữu'}">Lưu Tin Hữu</span>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Modern Sidebar Info -->
        <div class="col-lg-4">
          <!-- Guidelines Card -->
          <div class="modern-card">
            <div class="card-header">
              <div class="header-left">
                <div class="card-icon">
                  <i class="fas fa-lightbulb"></i>
                </div>
                <div class="card-title">
                  <h5>Hướng Dẫn</h5>
                  <p>Thông tin cần thiết khi tạo tin hữu</p>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div class="guideline-section">
                <h4>Thông tin bắt buộc</h4>
                <div class="requirement-list">
                  <div class="requirement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Họ và tên đầy đủ</span>
                  </div>
                </div>
              </div>

              <div class="guideline-section">
                <h4>Lưu ý quan trọng</h4>
                <div class="note-list">
                  <div class="note-item">
                    <i class="fas fa-phone"></i>
                    <span>Số điện thoại: 10-11 chữ số</span>
                  </div>
                  <div class="note-item">
                    <i class="fas fa-envelope"></i>
                    <span>Email phải có định dạng hợp lệ</span>
                  </div>
                  <div class="note-item">
                    <i class="fas fa-calendar"></i>
                    <span>Năm sinh từ 1900 đến hiện tại</span>
                  </div>
                </div>
              </div>

              <div class="warning-box">
                <div class="warning-icon">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="warning-content">
                  <strong>Chú ý:</strong> Thông tin tin hữu sẽ được sử dụng cho các hoạt động của chi hội.
                </div>
              </div>
            </div>
          </div>

          <!-- Stats Card (if editing) -->
          <div class="modern-card" th:if="${tinHuu.id != null}">
            <div class="card-header">
              <div class="header-left">
                <div class="card-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="card-title">
                  <h5>Thông Tin Hệ Thống</h5>
                  <p>Chi tiết về bản ghi</p>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-value" th:text="${tinHuu.id}">-</div>
                  <div class="stat-label">ID Tin Hữu</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">
                    <span th:if="${tinHuu.createdAt}"
                      th:text="${#temporals.format(tinHuu.createdAt, 'dd/MM/yyyy')}">-</span>
                    <span th:unless="${tinHuu.createdAt}">-</span>
                  </div>
                  <div class="stat-label">Ngày Tạo</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <div th:replace="~{fragments/admin-layout :: scripts}"></div>
  <script>
    // Form validation
    (function () {
      "use strict";
      window.addEventListener(
        "load",
        function () {
          var forms = document.getElementsByClassName("needs-validation");
          var validation = Array.prototype.filter.call(
            forms,
            function (form) {
              form.addEventListener(
                "submit",
                function (event) {
                  if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                  }
                  form.classList.add("was-validated");
                },
                false
              );
            }
          );
        },
        false
      );
    })();

    // Phone number validation
    const phoneInput = document.getElementById("dienThoai");
    phoneInput.addEventListener("input", function (e) {
      // Chỉ cho phép nhập số
      this.value = this.value.replace(/[^0-9]/g, "");

      // Giới hạn độ dài 10-11 số
      if (this.value.length > 11) {
        this.value = this.value.slice(0, 11);
      }

      // Validation feedback
      if (this.value.length > 0 && (this.value.length < 10 || this.value.length > 11)) {
        this.setCustomValidity('Số điện thoại phải có 10-11 chữ số');
      } else {
        this.setCustomValidity('');
      }
    });

    // Birth year validation
    const birthYearInput = document.getElementById("namSinh");
    const currentYear = new Date().getFullYear();
    birthYearInput.setAttribute('max', currentYear);

    birthYearInput.addEventListener("change", function (e) {
      const birthYear = parseInt(e.target.value);

      if (birthYear > currentYear) {
        alert("Năm sinh không thể lớn hơn năm hiện tại!");
        e.target.value = "";
      } else if (birthYear < 1900) {
        alert("Năm sinh không hợp lệ!");
        e.target.value = "";
      }
    });

    // Avatar preview function
    function previewAvatar(input) {
      const file = input.files[0];
      const preview = document.getElementById('avatarPreview');
      const status = document.getElementById('uploadStatus');

      if (file) {
        // Validate file size (5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('File quá lớn! Vui lòng chọn file nhỏ hơn 5MB.');
          input.value = '';
          return;
        }

        // Validate file type
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        if (!allowedTypes.includes(file.type)) {
          alert('Định dạng file không được hỗ trợ! Chỉ chấp nhận JPG, JPEG, PNG, GIF.');
          input.value = '';
          return;
        }

        // Show preview
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          status.classList.remove('d-none');
        };
        reader.readAsDataURL(file);
      } else {
        // Reset to original avatar if no file selected
        const originalSrc = preview.getAttribute('data-original') || '/images/default-avatar.svg';
        preview.src = originalSrc;
        status.classList.add('d-none');
      }
    }

    // Store original avatar URL for reset
    document.addEventListener('DOMContentLoaded', function () {
      const preview = document.getElementById('avatarPreview');
      preview.setAttribute('data-original', preview.src);
    });

    // Form validation and cleanup
    document.querySelector('form').addEventListener('submit', function (e) {
      const hoTen = document.getElementById('hoTen').value.trim();
      const phoneValue = phoneInput.value;
      const birthYearValue = birthYearInput.value;

      if (!hoTen) {
        alert('Vui lòng nhập họ tên!');
        e.preventDefault();
        return;
      }

      // Validate phone number
      if (phoneValue && (phoneValue.length < 10 || phoneValue.length > 11 || !/^[0-9]+$/.test(phoneValue))) {
        e.preventDefault();
        alert('Số điện thoại không hợp lệ! Vui lòng nhập 10-11 chữ số.');
        phoneInput.focus();
        return;
      }

      // Validate birth year
      if (birthYearValue) {
        const birthYear = parseInt(birthYearValue);
        const currentYear = new Date().getFullYear();

        if (birthYear > currentYear || birthYear < 1900) {
          e.preventDefault();
          alert('Năm sinh không hợp lệ!');
          birthYearInput.focus();
          return;
        }
      }

      // Clean up empty fields to ensure they are submitted as empty (will be converted to null)
      const fields = ['gioiTinh', 'email', 'dienThoai', 'diaChi', 'ngheNghiep', 'ghiChu', 'tinhTrangHonNhan'];
      fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && field.value.trim() === '') {
          field.value = '';
        }
      });
    });
  </script>

  <!-- Modern Form Styles -->
  <style>
    /* Modern Admin Page Styles */
    .modern-admin-page {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }

    /* Modern Page Header */
    .modern-page-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      color: white;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .header-icon {
      width: 70px;
      height: 70px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .header-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      margin: 0.5rem 0 0 0;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    /* Modern Buttons */
    .btn-modern {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      cursor: pointer;
    }

    .btn-modern-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-modern-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      color: white;
      text-decoration: none;
    }

    .btn-modern-outline {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .btn-modern-outline:hover {
      background: rgba(255, 255, 255, 0.3);
      color: white;
      text-decoration: none;
    }

    /* Modern Cards */
    .modern-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem;
      background: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .card-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }

    .card-title h5 {
      margin: 0;
      font-weight: 600;
      color: #2d3748;
    }

    .card-title p {
      margin: 0.25rem 0 0 0;
      color: #718096;
      font-size: 0.9rem;
    }

    .card-content {
      padding: 2rem;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .header-icon {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.2);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      backdrop-filter: blur(10px);
    }

    .header-title {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header-subtitle {
      color: rgba(255,255,255,0.9);
      margin: 0.5rem 0 0 0;
      font-size: 1.1rem;
    }

    .modern-form-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      overflow: hidden;
      border: none;
    }

    .form-card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 2rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .form-card-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .form-card-title h3 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: #2d3748;
    }

    .form-card-title p {
      margin: 0.25rem 0 0 0;
      color: #718096;
      font-size: 0.95rem;
    }

    .form-card-body {
      padding: 2rem;
    }

    /* Avatar Upload Section */
    .avatar-upload-section {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 2px dashed #e2e8f0;
      transition: all 0.3s ease;
    }

    .avatar-upload-section:hover {
      border-color: #667eea;
      background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .section-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
    }

    .section-title h4 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: #2d3748;
    }

    .section-title p {
      margin: 0.25rem 0 0 0;
      color: #718096;
      font-size: 0.9rem;
    }

    .avatar-upload-container {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .avatar-preview-wrapper {
      position: relative;
    }

    .avatar-preview-circle {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      border: 4px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .avatar-preview-circle:hover {
      border-color: #667eea;
      transform: scale(1.05);
    }

    .avatar-preview-circle img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(102, 126, 234, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      color: white;
      font-size: 24px;
    }

    .avatar-preview-circle:hover .avatar-overlay {
      opacity: 1;
    }

    .avatar-upload-controls {
      flex: 1;
    }

    .upload-btn {
      display: inline-flex;
      align-items: center;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      margin-bottom: 1rem;
    }

    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      color: white;
    }

    .upload-info {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .info-item {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      color: #718096;
    }

    .upload-status {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
    }

    .status-message {
      display: flex;
      align-items: center;
      font-weight: 500;
    }

    /* Form Dividers */
    .form-divider {
      display: flex;
      align-items: center;
      margin: 2rem 0;
      gap: 1rem;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #e2e8f0 50%, transparent 100%);
    }

    .divider-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 500;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    /* Form Sections */
    .form-section {
      margin-bottom: 2rem;
    }

    /* Modern Form Controls */
    .modern-form-group {
      margin-bottom: 1.5rem;
    }

    .modern-form-label {
      display: flex;
      align-items: center;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .required-star {
      color: #e53e3e;
      margin-left: 0.25rem;
    }

    .modern-form-control,
    .modern-form-select,
    .modern-form-textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .modern-form-control:focus,
    .modern-form-select:focus,
    .modern-form-textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }

    .modern-form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-hint {
      font-size: 0.85rem;
      color: #718096;
      margin-top: 0.25rem;
    }

    .form-feedback {
      font-size: 0.85rem;
      color: #e53e3e;
      margin-top: 0.25rem;
      display: none;
    }

    .modern-form-control:invalid + .form-feedback {
      display: block;
    }

    /* Form Actions */
    .form-actions {
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid #e2e8f0;
    }

    .actions-container {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .btn-cancel {
      padding: 0.75rem 1.5rem;
      background: #f7fafc;
      color: #4a5568;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }

    .btn-cancel:hover {
      background: #edf2f7;
      border-color: #cbd5e0;
      color: #2d3748;
      transform: translateY(-1px);
    }

    .btn-submit {
      padding: 0.75rem 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    /* Info Cards */
    .info-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    .info-card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 1.5rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .info-card-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
    }

    .info-card-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2d3748;
    }

    .info-card-body {
      padding: 1.5rem;
    }

    .guideline-section {
      margin-bottom: 1.5rem;
    }

    .guideline-section h4 {
      font-size: 1rem;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 0.75rem;
    }

    .requirement-list,
    .note-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .requirement-item,
    .note-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: #4a5568;
    }

    .requirement-item i {
      color: #48bb78;
    }

    .note-item i {
      color: #667eea;
      width: 16px;
    }

    .warning-box {
      background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
      border: 1px solid #fc8181;
      border-radius: 10px;
      padding: 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .warning-icon {
      color: #c53030;
      font-size: 1.1rem;
      margin-top: 0.1rem;
    }

    .warning-content {
      color: #742a2a;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 10px;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }

      .avatar-upload-container {
        flex-direction: column;
        text-align: center;
      }

      .actions-container {
        flex-direction: column;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Dropdown Styles */
    .nhom-item {
      padding: 8px 0;
    }
    
    .nhom-name {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }
    
    .diem-nhom-name {
      font-size: 14px;
      color: #666;
      margin-bottom: 2px;
    }
    
    .diem-nhom-address {
      font-size: 12px;
      color: #999;
    }
    
    #nhomDropdown .dropdown-item {
      padding: 12px 16px !important;
      border-bottom: 1px solid #f0f0f0;
    }
    
    #nhomDropdown .dropdown-item:last-child {
      border-bottom: none;
    }
    
    #nhomDropdown .dropdown-item:hover {
      background-color: #f8f9fa;
    }
  </style>

  <!-- Searchable Dropdown Scripts -->
  <script src="/static/js/searchable-dropdown.js"></script>
  <script>
    let banNganhDropdown;
    let nhomDropdown;

    document.addEventListener('DOMContentLoaded', function () {
      // Khởi tạo searchable dropdown cho ban ngành
      banNganhDropdown = new SearchableDropdown('banNganhDropdown', {
        placeholder: 'Chọn ban ngành...',
        searchPlaceholder: 'Tìm kiếm ban ngành...',
        displayField: 'tenBan',
        valueField: 'id',
        allowClear: true,
        clearText: 'Không chọn ban ngành',
        onSelect: function (item) {
          // Cập nhật hidden input
          document.getElementById('banNganh').value = item.id;
        },
        onClear: function() {
          // Clear hidden input
          document.getElementById('banNganh').value = '';
        }
      });

      // COMMENTED OUT - Nhóm dropdown initialization
      /*
      nhomDropdown = new SearchableDropdown('nhomDropdown', {
        placeholder: 'Chọn nhóm...',
        searchPlaceholder: 'Tìm kiếm nhóm...',
        displayField: 'displayText',
        valueField: 'id',
        allowClear: true,
        clearText: 'Không chọn nhóm',
        onSelect: function (item) {
          // Cập nhật hidden input
          document.getElementById('nhom').value = item.id;
        },
        onClear: function() {
          // Clear hidden input
          document.getElementById('nhom').value = '';
        }
      });
      */

      // Load ban ngành
      loadAllBanNganh();

      // COMMENTED OUT - Load nhóm
      // loadAllNhom();

      // Set giá trị hiện tại nếu có (cho edit mode)
      const currentBanNganhValue = document.getElementById('banNganh').value;
      // const currentNhomValue = document.getElementById('nhom').value; // COMMENTED OUT

      if (currentBanNganhValue) {
        setTimeout(() => {
          banNganhDropdown.setValue(currentBanNganhValue);
        }, 500);
      }

      // COMMENTED OUT - Set nhóm value
      /*
      if (currentNhomValue) {
        setTimeout(() => {
          nhomDropdown.setValue(currentNhomValue);
        }, 500);
      }
      */
    });

    // Load tất cả ban ngành
    function loadAllBanNganh() {
      fetch('/admin/api/all-ban-nganh')
        .then(response => response.json())
        .then(data => {
          banNganhDropdown.setData(data);
        })
        .catch(error => {
          console.error('Error loading ban ngành:', error);
        });
    }

    // COMMENTED OUT - Load tất cả nhóm với thông tin điểm nhóm
    /*
    function loadAllNhom() {
      fetch('/admin/api/all-nhom-with-diem-nhom')
        .then(response => response.json())
        .then(data => {
          // Format data để tạo displayText đơn giản
          const formattedData = data.map(item => {
            let displayText = item.tenNhom;
            
            if (item.diemNhom) {
              displayText += ` - ${item.diemNhom.tenDiemNhom}`;
              if (item.diemNhom.diaChi) {
                displayText += ` (${item.diemNhom.diaChi})`;
              }
            }
            
            return {
              id: item.id,
              tenNhom: item.tenNhom,
              diemNhom: item.diemNhom,
              displayText: displayText
            };
          });
          
          nhomDropdown.setData(formattedData);
        })
        .catch(error => {
          console.error('Error loading nhóm:', error);
        });
    }
    */
  </script>
</body>

</html>