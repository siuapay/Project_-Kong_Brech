<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/admin-layout :: head}"></head>
  <body>
    <!-- Sidebar -->
    <nav th:replace="~{fragments/admin-layout :: sidebar}"></nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Navigation -->
      <nav th:replace="~{fragments/admin-layout :: topnav}"></nav>

      <!-- Content -->
      <div class="container-fluid py-4">
        <!-- Flash Messages -->
        <div th:replace="~{fragments/admin-layout :: messages}"></div>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="text-primary">
              <i class="fas fa-users-cog me-2"></i>Hồ Sơ Chấp Sự
            </h2>
            <p class="text-muted mb-0">
              Thông tin chi tiết và đầy đủ của chấp sự
            </p>
          </div>
          <div class="d-flex gap-2">
            <a
              th:href="@{/admin/chap-su/{id}/edit(id=${chapSu.id})}"
              class="btn btn-warning"
            >
              <i class="fas fa-edit me-2"></i>Chỉnh Sửa
            </a>
            <a th:href="@{/admin/chap-su}" class="btn btn-secondary">
              <i class="fas fa-arrow-left me-2"></i>Quay Lại
            </a>
          </div>
        </div>

        <div class="row">
          <!-- Main Profile Card -->
          <div class="col-lg-4">
            <div class="card shadow-lg border-0">
              <div class="card-body text-center p-4">
                <!-- Avatar -->
                <div class="mb-4">
                  <img
                    th:src="${chapSu.avatarUrl != null ? chapSu.avatarUrl : '/static/images/default-avatar.svg'}"
                    alt="Avatar"
                    class="rounded-circle border shadow"
                    style="width: 120px; height: 120px; object-fit: cover"
                  />
                </div>

                <!-- Name & Basic Info -->
                <h3 class="text-primary mb-1" th:text="${chapSu.hoTen}">
                  Tên Chấp Sự
                </h3>
                <p class="text-muted mb-3">
                  <span th:if="${chapSu.chucVu}" th:text="${chapSu.chucVu.displayName}"></span>
                  <span th:unless="${chapSu.chucVu}">Chưa cập nhật chức vụ</span>
                </p>

                <!-- Status Badge -->
                <div class="mb-4">
                  <span th:switch="${chapSu.trangThai?.name()}">
                    <span
                      th:case="'DANG_NHIEM_VU'"
                      class="badge bg-success fs-6 px-3 py-2"
                    >
                      <i class="fas fa-check-circle me-1"></i>Đang Nhiệm Vụ
                    </span>
                    <span
                      th:case="'HET_NHIEM_KY'"
                      class="badge bg-warning fs-6 px-3 py-2"
                    >
                      <i class="fas fa-clock me-1"></i>Hết Nhiệm Kỳ
                    </span>
                    <span
                      th:case="'TAM_NGHI'"
                      class="badge bg-secondary fs-6 px-3 py-2"
                    >
                      <i class="fas fa-pause-circle me-1"></i>Tạm Nghỉ
                    </span>
                    <span
                      th:case="'CHUYEN_DI'"
                      class="badge bg-danger fs-6 px-3 py-2"
                    >
                      <i class="fas fa-arrow-right me-1"></i>Chuyển Đi
                    </span>
                    <span th:case="*" class="badge bg-secondary fs-6 px-3 py-2"
                      >Không xác định</span
                    >
                  </span>
                </div>

                <!-- Quick Contact -->
                <div class="d-grid gap-2">
                  <a
                    th:if="${chapSu.dienThoai}"
                    th:href="'tel:' + ${chapSu.dienThoai}"
                    class="btn btn-outline-success"
                  >
                    <i class="fas fa-phone me-2"></i
                    ><span th:text="${chapSu.dienThoai}"></span>
                  </a>
                  <a
                    th:if="${chapSu.email}"
                    th:href="'mailto:' + ${chapSu.email}"
                    class="btn btn-outline-primary"
                  >
                    <i class="fas fa-envelope me-2"></i
                    ><span th:text="${chapSu.email}"></span>
                  </a>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow border-0 mt-4">
              <div class="card-header bg-gradient-primary text-white">
                <h6 class="mb-0">
                  <i class="fas fa-bolt me-2"></i>Thao Tác Nhanh
                </h6>
              </div>
              <div class="card-body">
                <div class="d-grid gap-2">
                  <a
                    th:href="@{/admin/chap-su/{id}/edit(id=${chapSu.id})}"
                    class="btn btn-warning"
                  >
                    <i class="fas fa-edit me-2"></i>Chỉnh Sửa
                  </a>
                  <button
                    type="button"
                    class="btn btn-danger"
                    th:data-id="${chapSu.id}"
                    th:data-name="${chapSu.hoTen}"
                    onclick="confirmDelete(this.dataset.id, this.dataset.name)"
                  >
                    <i class="fas fa-trash me-2"></i>Xóa Chấp Sự
                  </button>
                  <hr />
                  <a
                    th:href="@{/admin/chap-su}"
                    class="btn btn-outline-secondary"
                  >
                    <i class="fas fa-list me-2"></i>Danh Sách
                  </a>
                  <a
                    th:href="@{/admin/chap-su/new}"
                    class="btn btn-outline-primary"
                  >
                    <i class="fas fa-plus me-2"></i>Thêm Mới
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Detailed Information -->
          <div class="col-lg-8">
            <!-- Personal Information -->
            <div class="card shadow border-0 mb-4">
              <div class="card-header bg-light border-0">
                <h5 class="text-primary mb-0">
                  <i class="fas fa-user me-2"></i>Thông Tin Cá Nhân
                </h5>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Họ và Tên</label>
                      <div class="info-value" th:text="${chapSu.hoTen}">-</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Chức Vụ</label>
                      <div class="info-value">
                        <span th:if="${chapSu.chucVu}">
                          <i class="fas fa-user-tie text-primary me-2"></i>
                          <span th:text="${chapSu.chucVu.displayName}"></span>
                        </span>
                        <span th:unless="${chapSu.chucVu}" class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Ngày Sinh</label>
                      <div class="info-value">
                        <span th:if="${chapSu.ngaySinh}">
                          <i class="fas fa-birthday-cake me-1 text-warning"></i>
                          <span
                            th:text="${#temporals.format(chapSu.ngaySinh, 'dd/MM/yyyy')}"
                          ></span>
                          <small class="text-muted"
                            >(<span
                              th:text="${chapSu.tuoi}"
                            ></span>
                            tuổi)</small
                          >
                        </span>
                        <span th:unless="${chapSu.ngaySinh}" class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Ngày Bắt Đầu Phục Vụ</label>
                      <div class="info-value">
                        <span th:if="${chapSu.ngayBatDauPhucVu}">
                          <i
                            class="fas fa-calendar-check text-success me-2"
                          ></i>
                          <span
                            th:text="${#temporals.format(chapSu.ngayBatDauPhucVu, 'dd/MM/yyyy')}"
                          ></span>
                        </span>
                        <span
                          th:unless="${chapSu.ngayBatDauPhucVu}"
                          class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Nhiệm Kỳ Bắt Đầu</label>
                      <div class="info-value">
                        <span th:if="${chapSu.nhiemKyBatDau}">
                          <i class="fas fa-calendar-alt text-info me-2"></i>
                          <span
                            th:text="${#temporals.format(chapSu.nhiemKyBatDau, 'dd/MM/yyyy')}"
                          ></span>
                        </span>
                        <span
                          th:unless="${chapSu.nhiemKyBatDau}"
                          class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Nhiệm Kỳ Kết Thúc</label>
                      <div class="info-value">
                        <span th:if="${chapSu.nhiemKyKetThuc}">
                          <i class="fas fa-calendar-times text-warning me-2"></i>
                          <span
                            th:text="${#temporals.format(chapSu.nhiemKyKetThuc, 'dd/MM/yyyy')}"
                          ></span>
                        </span>
                        <span
                          th:unless="${chapSu.nhiemKyKetThuc}"
                          class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="card shadow border-0 mb-4">
              <div class="card-header bg-light border-0">
                <h5 class="text-success mb-0">
                  <i class="fas fa-address-book me-2"></i>Thông Tin Liên Hệ
                </h5>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Số Điện Thoại</label>
                      <div class="info-value">
                        <span th:if="${chapSu.dienThoai}">
                          <i class="fas fa-phone text-success me-2"></i>
                          <a
                            th:href="'tel:' + ${chapSu.dienThoai}"
                            class="text-decoration-none"
                          >
                            <span th:text="${chapSu.dienThoai}"></span>
                          </a>
                        </span>
                        <span th:unless="${chapSu.dienThoai}" class="text-muted"
                          >Chưa có</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Email</label>
                      <div class="info-value">
                        <span th:if="${chapSu.email}">
                          <i class="fas fa-envelope text-primary me-2"></i>
                          <a
                            th:href="'mailto:' + ${chapSu.email}"
                            class="text-decoration-none"
                          >
                            <span th:text="${chapSu.email}"></span>
                          </a>
                        </span>
                        <span th:unless="${chapSu.email}" class="text-muted"
                          >Chưa có</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="info-item">
                      <label class="info-label">Địa Chỉ</label>
                      <div class="info-value">
                        <span th:if="${chapSu.diaChi}">
                          <i class="fas fa-map-marker-alt text-danger me-2"></i>
                          <span th:text="${chapSu.diaChi}"></span>
                        </span>
                        <span th:unless="${chapSu.diaChi}" class="text-muted"
                          >Chưa cập nhật</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Work Information -->
            <div class="card shadow border-0 mb-4">
              <div class="card-header bg-light border-0">
                <h5 class="text-info mb-0">
                  <i class="fas fa-briefcase me-2"></i>Thông Tin Công Việc
                </h5>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Ban Ngành</label>
                      <div class="info-value">
                        <span th:if="${chapSu.banNganh}">
                          <i class="fas fa-building text-primary me-2"></i>
                          <span th:text="${chapSu.banNganh.tenBan}"></span>
                          <small class="text-muted"
                            >(<span th:text="${chapSu.banNganh.maBan}"></span
                            >)</small
                          >
                        </span>
                        <span th:unless="${chapSu.banNganh}" class="text-muted"
                          >Chưa phân công</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Trạng Thái</label>
                      <div class="info-value">
                        <span th:switch="${chapSu.trangThai?.name()}">
                          <span th:case="'DANG_NHIEM_VU'" class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Đang nhiệm vụ
                          </span>
                          <span
                            th:case="'HET_NHIEM_KY'"
                            class="badge bg-warning"
                          >
                            <i class="fas fa-clock me-1"></i>Hết nhiệm kỳ
                          </span>
                          <span th:case="'TAM_NGHI'" class="badge bg-secondary">
                            <i class="fas fa-pause-circle me-1"></i>Tạm nghỉ
                          </span>
                          <span th:case="'CHUYEN_DI'" class="badge bg-danger">
                            <i class="fas fa-arrow-right me-1"></i>Chuyển đi
                          </span>
                          <span th:case="*" class="badge bg-secondary"
                            >Không xác định</span
                          >
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="info-item">
                      <label class="info-label">Điểm Nhóm</label>
                      <div class="info-value">
                        <span th:if="${chapSu.diemNhom}">
                          <i
                            class="fas fa-map-marker-alt text-success me-2"
                          ></i>
                          <span th:text="${chapSu.diemNhom.tenDiemNhom}"></span>
                        </span>
                        <span th:unless="${chapSu.diemNhom}" class="text-muted"
                          >Chưa phân công</span
                        >
                      </div>
                    </div>
                  </div>

                  <div
                    class="col-md-6"
                    th:if="${chapSu.diemNhom != null and chapSu.diemNhom.diaChi != null}"
                  >
                    <div class="info-item">
                      <label class="info-label">Địa Chỉ Điểm Nhóm</label>
                      <div class="info-value">
                        <i class="fas fa-location-arrow text-info me-2"></i>
                        <span th:text="${chapSu.diemNhom.diaChi}"></span>
                      </div>
                    </div>
                  </div>
                  <div class="col-12" th:if="${chapSu.moTaCongViec}">
                    <div class="info-item">
                      <label class="info-label">Mô Tả Công Việc</label>
                      <div class="info-value">
                        <div
                          class="note-box bg-light border-start border-4 border-warning p-3 rounded"
                        >
                          <i class="fas fa-briefcase text-warning me-2"></i>
                          <span
                            th:text="${chapSu.moTaCongViec}"
                            style="white-space: pre-line;"
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12" th:if="${chapSu.danhSachTrachNhiem != null and !chapSu.danhSachTrachNhiem.empty}">
                    <div class="info-item">
                      <label class="info-label">Danh Sách Trách Nhiệm</label>
                      <div class="info-value">
                        <div class="note-box bg-light border-start border-4 border-success p-3 rounded">
                          <i class="fas fa-tasks text-success me-2"></i>
                          <ul class="mb-0">
                            <li th:each="trachNhiem : ${chapSu.danhSachTrachNhiem}" th:text="${trachNhiem}"></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="info-item">
                      <label class="info-label">Tiểu Sử</label>
                      <div class="info-value">
                        <div
                          class="note-box bg-light border-start border-4 border-primary p-3 rounded"
                        >
                          <i class="fas fa-user-graduate text-primary me-2"></i>
                          <span
                            th:if="${chapSu.tieuSu}"
                            th:text="${chapSu.tieuSu}"
                            style="white-space: pre-line;"
                          ></span>
                          <span th:unless="${chapSu.tieuSu}" class="text-muted"
                            >Chưa có tiểu sử</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="info-item">
                      <label class="info-label">Ghi Chú</label>
                      <div class="info-value">
                        <div
                          class="note-box bg-light border-start border-4 border-info p-3 rounded"
                        >
                          <i class="fas fa-sticky-note text-info me-2"></i>
                          <span
                            th:if="${chapSu.ghiChu}"
                            th:text="${chapSu.ghiChu}"
                          ></span>
                          <span th:unless="${chapSu.ghiChu}" class="text-muted"
                            >Chưa có ghi chú</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- System Information -->
            <div class="card shadow border-0">
              <div class="card-header bg-light border-0">
                <h5 class="text-secondary mb-0">
                  <i class="fas fa-info-circle me-2"></i>Thông Tin Hệ Thống
                </h5>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-4">
                    <div class="info-item text-center">
                      <label class="info-label">ID Chấp Sự</label>
                      <div class="info-value">
                        <span
                          class="badge bg-primary fs-6"
                          th:text="'#' + ${chapSu.id}"
                        ></span>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="info-item text-center">
                      <label class="info-label">Ngày Tạo</label>
                      <div class="info-value">
                        <span th:if="${chapSu.createdAt}">
                          <i class="fas fa-calendar-plus text-success me-1"></i>
                          <span
                            th:text="${#temporals.format(chapSu.createdAt, 'dd/MM/yyyy')}"
                          ></span>
                        </span>
                        <span th:unless="${chapSu.createdAt}" class="text-muted"
                          >-</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="info-item text-center">
                      <label class="info-label">Cập Nhật Cuối</label>
                      <div class="info-value">
                        <span th:if="${chapSu.updatedAt}">
                          <i class="fas fa-edit text-warning me-1"></i>
                          <span
                            th:text="${#temporals.format(chapSu.updatedAt, 'dd/MM/yyyy')}"
                          ></span>
                        </span>
                        <span th:unless="${chapSu.updatedAt}" class="text-muted"
                          >-</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Xác Nhận Xóa</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Bạn có chắc chắn muốn xóa chấp sự
              <strong id="deleteName"></strong>?
            </p>
            <p class="text-danger">
              <i class="fas fa-exclamation-triangle me-1"></i>Hành động này
              không thể hoàn tác!
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Hủy
            </button>
            <form id="deleteForm" method="post" class="d-inline">
              <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash me-1"></i>Xóa
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{fragments/admin-layout :: scripts}"></div>
    <script>
      function confirmDelete(id, name) {
        document.getElementById("deleteName").textContent = name;
        document.getElementById("deleteForm").action =
          "/admin/chap-su/delete/" + id;
        new bootstrap.Modal(document.getElementById("deleteModal")).show();
      }
    </script>

    <style>
      .avatar-xl {
        width: 120px;
        height: 120px;
        font-size: 48px;
      }

      .info-item {
        padding: 12px 0;
      }

      .info-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
        display: block;
      }

      .info-value {
        font-size: 1rem;
        font-weight: 500;
        color: #495057;
      }

      .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .card {
        transition: transform 0.2s ease-in-out;
      }

      .card:hover {
        transform: translateY(-2px);
      }

      .border-4 {
        border-width: 4px !important;
      }

      .note-box {
        background-color: #f8f9fa !important;
        border-left: 4px solid #17a2b8 !important;
        font-size: 0.95rem;
        line-height: 1.5;
      }
    </style>
  </body>
</html>