<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/admin-layout :: head}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .finance-dashboard {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
      }

      .hero-card {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(79, 70, 229, 0.3);
      }
      
      .hero-card .card-body {
        color: white !important;
      }
      
      .hero-card h1, .hero-card p {
        color: white !important;
      }

      .metric-card {
        transition: all 0.3s ease;
        border-radius: 12px;
        border: none;
      }

      .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .action-card {
        transition: all 0.3s ease;
        border-radius: 12px;
        border: none;
      }

      .action-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      .btn-action {
        transition: all 0.3s ease;
        border-radius: 10px;
        font-weight: 500;
      }

      .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .stats-icon {
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
      }

      .year-highlight {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border-radius: 15px;
        color: white;
      }

      .table-modern {
        border-radius: 12px;
        overflow: hidden;
      }

      .table-modern thead th {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        border: none;
        font-weight: 600;
      }

      .table-modern tbody tr {
        transition: all 0.2s ease;
      }

      .table-modern tbody tr:hover {
        background-color: rgba(102, 126, 234, 0.05);
        transform: scale(1.01);
      }

      @media (max-width: 768px) {
        .hero-card .row {
          text-align: center;
        }

        .hero-card .col-md-4 {
          margin-top: 1rem;
        }

        .btn-action {
          font-size: 0.9rem;
          padding: 0.75rem;
        }
      }
    </style>
  </head>
  <body class="finance-dashboard">
    <!-- Sidebar -->
    <nav th:replace="~{fragments/admin-layout :: sidebar}"></nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Navigation -->
      <nav th:replace="~{fragments/admin-layout :: topnav}"></nav>

      <!-- Content -->
      <div class="container-fluid py-4">
        <!-- Flash Messages -->
        <div th:replace="~{fragments/admin-layout :: messages}"></div>

        <!-- Page Header with Welcome Message -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card hero-card border-0 shadow-lg">
              <div class="card-body py-4" style="color: blue !important;">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <h1 class="mb-2">
                      <i class="fas fa-coins me-3"></i>Quản Lý Tài Chính
                    </h1>
                    <p class="mb-0 fs-5 opacity-90">
                      Chào mừng đến với hệ thống quản lý tài chính. Bạn có thể
                      xem tổng quan, thêm giao dịch mới hoặc xem báo cáo chi
                      tiết.
                    </p>
                  </div>
                  <div class="col-md-4 text-end">
                    <div class="d-flex flex-column gap-2">
                      <a
                        th:href="@{/admin/tai-chinh/giao-dich/add}"
                        class="btn btn-success btn-lg"
                      >
                        <i class="fas fa-plus me-2"></i>Thêm Giao Dịch Mới
                      </a>
                      <a
                        th:href="@{/admin/tai-chinh/thong-ke}"
                        class="btn btn-warning"
                      >
                        <i class="fas fa-chart-bar me-2"></i>Xem Báo Cáo
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Key Financial Metrics -->
        <div class="row g-4 mb-4">
          <!-- Total Income -->
          <div class="col-lg-4 col-md-6">
            <div class="card metric-card border-0 shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-shrink-0">
                    <div class="bg-success bg-opacity-10 rounded-3 p-3">
                      <i class="fas fa-arrow-up fa-2x text-success"></i>
                    </div>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="text-muted mb-1">Tổng Thu Nhập</h6>
                    <h3
                      class="text-success mb-0"
                      th:text="${#numbers.formatDecimal(totalThu, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
                    >
                      0 VNĐ
                    </h3>
                    <small class="text-muted">Tất cả các năm</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Total Expense -->
          <div class="col-lg-4 col-md-6">
            <div class="card metric-card border-0 shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-shrink-0">
                    <div class="bg-danger bg-opacity-10 rounded-3 p-3">
                      <i class="fas fa-arrow-down fa-2x text-danger"></i>
                    </div>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="text-muted mb-1">Tổng Chi Phí</h6>
                    <h3
                      class="text-danger mb-0"
                      th:text="${#numbers.formatDecimal(totalChi, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
                    >
                      0 VNĐ
                    </h3>
                    <small class="text-muted">Tất cả các năm</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Net Balance -->
          <div class="col-lg-4 col-md-12">
            <div class="card metric-card border-0 shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-shrink-0">
                    <div
                      th:class="${totalSoDu >= 0} ? 'bg-primary bg-opacity-10 rounded-3 p-3' : 'bg-warning bg-opacity-10 rounded-3 p-3'"
                    >
                      <i
                        class="fas fa-balance-scale fa-2x"
                        th:class="${totalSoDu >= 0} ? 'fas fa-balance-scale fa-2x text-primary' : 'fas fa-balance-scale fa-2x text-warning'"
                      ></i>
                    </div>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="text-muted mb-1">Số Dư Hiện Tại</h6>
                    <h3
                      class="mb-0"
                      th:class="${totalSoDu >= 0} ? 'text-primary' : 'text-warning'"
                      th:text="${#numbers.formatDecimal(totalSoDu, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
                    >
                      0 VNĐ
                    </h3>
                    <small
                      class="badge"
                      th:class="${totalSoDu > 0} ? 'bg-success' : (${totalSoDu < 0} ? 'bg-danger' : 'bg-warning')"
                      th:text="${totalSoDu > 0} ? 'Dương' : (${totalSoDu < 0} ? 'Âm' : 'Cân bằng')"
                      >Trạng thái</small
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Current Year Highlight -->
        <div class="row mb-4" th:if="${currentYearData}">
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-4">
                <div class="row align-items-center">
                  <div class="col-md-6">
                    <h4 class="text-primary mb-3">
                      <i class="fas fa-calendar-check me-2"></i>Tài Chính Năm
                      <span th:text="${currentYear}">2024</span>
                    </h4>
                    <div class="row g-3">
                      <div class="col-sm-4">
                        <div class="text-center">
                          <div
                            class="text-success fs-4 fw-bold"
                            th:text="${#numbers.formatDecimal(currentYearData.tongThu, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">Thu Nhập</small>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="text-center">
                          <div
                            class="text-danger fs-4 fw-bold"
                            th:text="${#numbers.formatDecimal(currentYearData.tongChi, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">Chi Phí</small>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="text-center">
                          <div
                            class="fs-4 fw-bold"
                            th:class="${currentYearData.soDu >= 0} ? 'text-primary' : 'text-warning'"
                            th:text="${#numbers.formatDecimal(currentYearData.soDu, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">Số Dư</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 text-end">
                    <div class="mb-3">
                      <span
                        class="badge fs-6 px-3 py-2"
                        th:class="${currentYearData.soDu > 0} ? 'bg-success' : (${currentYearData.soDu < 0} ? 'bg-danger' : 'bg-warning')"
                        th:text="${currentYearData.trangThaiTaiChinh}"
                        >Trạng thái</span
                      >
                    </div>
                    <div class="d-flex gap-2 justify-content-end">
                      <a
                        th:href="@{/admin/tai-chinh/thong-ke/nam/{nam}(nam=${currentYear})}"
                        class="btn btn-outline-primary"
                      >
                        <i class="fas fa-chart-line me-1"></i>Chi Tiết
                      </a>
                      <a
                        th:href="@{/admin/tai-chinh/giao-dich(nam=${currentYear})}"
                        class="btn btn-outline-secondary"
                      >
                        <i class="fas fa-list me-1"></i>Giao Dịch
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Actions -->
        <div class="row g-4 mb-4">
          <!-- Primary Actions -->
          <div class="col-lg-8">
            <div class="card action-card border-0 shadow-sm">
              <div class="card-body p-4">
                <h5 class="card-title mb-4">
                  <i class="fas fa-tasks me-2 text-primary"></i>Thao Tác Chính
                </h5>
                <div class="row g-3">
                  <!-- Add Transaction - Most Important -->
                  <div class="col-md-6">
                    <div class="d-grid">
                      <a
                        th:href="@{/admin/tai-chinh/giao-dich/add}"
                        class="btn btn-success btn-action btn-lg py-3"
                      >
                        <i class="fas fa-plus-circle fa-2x d-block mb-2"></i>
                        <strong>Thêm Giao Dịch Mới</strong>
                        <small class="d-block mt-1 opacity-75"
                          >Ghi nhận thu chi mới</small
                        >
                      </a>
                    </div>
                  </div>

                  <!-- View Transactions -->
                  <div class="col-md-6">
                    <div class="d-grid">
                      <a
                        th:href="@{/admin/tai-chinh/giao-dich}"
                        class="btn btn-primary btn-action btn-lg py-3"
                      >
                        <i class="fas fa-list fa-2x d-block mb-2"></i>
                        <strong>Xem Giao Dịch</strong>
                        <small class="d-block mt-1 opacity-75"
                          >Danh sách tất cả giao dịch</small
                        >
                      </a>
                    </div>
                  </div>

                  <!-- Manage Categories -->
                  <div class="col-md-6">
                    <div class="d-grid">
                      <a
                        th:href="@{/admin/tai-chinh/danh-muc}"
                        class="btn btn-outline-info btn-action btn-lg py-3"
                      >
                        <i class="fas fa-folder-open fa-2x d-block mb-2"></i>
                        <strong>Quản Lý Danh Mục</strong>
                        <small class="d-block mt-1">Phân loại thu chi</small>
                      </a>
                    </div>
                  </div>

                  <!-- View Reports -->
                  <div class="col-md-6">
                    <div class="d-grid">
                      <a
                        th:href="@{/admin/tai-chinh/thong-ke}"
                        class="btn btn-outline-warning btn-action btn-lg py-3"
                      >
                        <i class="fas fa-chart-bar fa-2x d-block mb-2"></i>
                        <strong>Báo Cáo & Thống Kê</strong>
                        <small class="d-block mt-1">Phân tích tài chính</small>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-4">
                <h5 class="card-title mb-4">
                  <i class="fas fa-info-circle me-2 text-info"></i>Thông Tin
                  Nhanh
                </h5>
                <div class="d-flex flex-column gap-3">
                  <div
                    class="d-flex justify-content-between align-items-center p-3 bg-light rounded"
                  >
                    <div>
                      <i class="fas fa-folder text-info me-2"></i>
                      <span>Danh Mục</span>
                    </div>
                    <span
                      class="badge bg-info fs-6"
                      th:text="${totalCategories}"
                      >0</span
                    >
                  </div>
                  <div
                    class="d-flex justify-content-between align-items-center p-3 bg-light rounded"
                  >
                    <div>
                      <i class="fas fa-exchange-alt text-warning me-2"></i>
                      <span>Giao Dịch</span>
                    </div>
                    <span
                      class="badge bg-warning fs-6"
                      th:text="${totalTransactions}"
                      >0</span
                    >
                  </div>
                  <div
                    class="d-flex justify-content-between align-items-center p-3 bg-light rounded"
                  >
                    <div>
                      <i class="fas fa-calendar text-primary me-2"></i>
                      <span>Năm Hiện Tại</span>
                    </div>
                    <span class="badge bg-primary fs-6" th:text="${currentYear}"
                      >2024</span
                    >
                  </div>
                </div>

                <!-- Quick Year Navigation -->
                <div
                  class="mt-4"
                  th:if="${availableYears != null and #lists.size(availableYears) > 1}"
                >
                  <h6 class="text-muted mb-2">Xem Theo Năm:</h6>
                  <div class="dropdown w-100">
                    <button
                      class="btn btn-outline-secondary dropdown-toggle w-100"
                      type="button"
                      data-bs-toggle="dropdown"
                    >
                      <i class="fas fa-history me-2"></i>Chọn Năm
                    </button>
                    <ul class="dropdown-menu w-100">
                      <li th:each="year : ${availableYears}">
                        <a
                          class="dropdown-item"
                          th:href="@{/admin/tai-chinh/thong-ke/nam/{nam}(nam=${year})}"
                          th:text="'Năm ' + ${year}"
                          >Năm 2024</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Years Summary -->
        <div
          class="row"
          th:if="${recentYears != null and #lists.size(recentYears) > 0}"
        >
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">
                    <i class="fas fa-history me-2 text-secondary"></i>Lịch Sử
                    Tài Chính Theo Năm
                  </h5>
                  <small class="text-muted">Tổng quan các năm gần đây</small>
                </div>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-modern table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th class="ps-4">Năm</th>
                        <th class="text-center">Thu Nhập</th>
                        <th class="text-center">Chi Phí</th>
                        <th class="text-center">Số Dư</th>
                        <th class="text-center">Trạng Thái</th>
                        <th class="text-center pe-4">Thao Tác</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="year : ${recentYears}" class="align-middle">
                        <td class="ps-4">
                          <div class="d-flex align-items-center">
                            <div
                              class="bg-primary bg-opacity-10 rounded-circle p-2 me-3"
                            >
                              <i class="fas fa-calendar text-primary"></i>
                            </div>
                            <h6
                              class="mb-0 text-primary fw-bold"
                              th:text="${year.nam}"
                            >
                              2024
                            </h6>
                          </div>
                        </td>
                        <td class="text-center">
                          <div
                            class="text-success fw-bold"
                            th:text="${#numbers.formatDecimal(year.tongThu, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">VNĐ</small>
                        </td>
                        <td class="text-center">
                          <div
                            class="text-danger fw-bold"
                            th:text="${#numbers.formatDecimal(year.tongChi, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">VNĐ</small>
                        </td>
                        <td class="text-center">
                          <div
                            class="fw-bold"
                            th:class="${year.soDu >= 0} ? 'text-primary' : 'text-warning'"
                            th:text="${#numbers.formatDecimal(year.soDu, 0, 'COMMA', 0, 'POINT')}"
                          >
                            0
                          </div>
                          <small class="text-muted">VNĐ</small>
                        </td>
                        <td class="text-center">
                          <span
                            class="badge px-3 py-2"
                            th:class="${year.soDu > 0} ? 'bg-success' : (${year.soDu < 0} ? 'bg-danger' : 'bg-warning')"
                            th:text="${year.trangThaiTaiChinh}"
                            >Trạng thái</span
                          >
                        </td>
                        <td class="text-center pe-4">
                          <div class="btn-group" role="group">
                            <a
                              th:href="@{/admin/tai-chinh/thong-ke/nam/{nam}(nam=${year.nam})}"
                              class="btn btn-sm btn-outline-primary"
                              title="Xem báo cáo chi tiết"
                            >
                              <i class="fas fa-chart-line me-1"></i>Báo Cáo
                            </a>
                            <a
                              th:href="@{/admin/tai-chinh/giao-dich(nam=${year.nam})}"
                              class="btn btn-sm btn-outline-secondary"
                              title="Xem danh sách giao dịch"
                            >
                              <i class="fas fa-list me-1"></i>Giao Dịch
                            </a>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <div th:replace="~{fragments/admin-layout :: scripts}"></div>
  </body>
</html>
